<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>DApp Tutorial1</title>
  <script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script language="javascript" type="text/javascript" src="web3.min.js"></script>
  <script language="javascript" type="text/javascript" src="dailyRental_abi.js"></script>
  <style>
    body {
      background-color: #F0F0F0;
      padding: 2em;
      font-family: 'Raleway','Source Sans Pro', 'Arial';
    }

    .container {
      width: 50%;
      margin: 0 auto;
    }

    label {
      display: block;
      margin-bottom: 10px;
    }

    input {
      padding: 10px;
      width: 50%;
      margin-bottom: 1em;
    }

    button {
      margin: 2em 0;
      padding: 1em 4em;
      display: block;
    }


    #balance {
      padding: 1em;
      background-color: #fff;
      margin: 1em 0;
    }

    #status {
      font-weight: normal;
      font-family: monospace;
      padding: 1em;
      background-color: #fff;
      margin: 1em 0;
    }

    #statusD {
      padding: 1em;
      background-color: #fff;
      margin: 1em 0;
    }
  </style>

</head>
<body>
  <!-- Form -->
  <div class="container">
    <h1>Daily Rental</h1>
    <h3>Room</h3>
    <h4 style="display: inline-block">101 </h4>
    <statusD id="status101" style="display: inline-block"> test<span id="status101"></span></statusD>
    <button id="button" style="    display: inline-block" onclick="javascript:getStatusRoom101(101)">check status</button>
    <button id="button" style="    display: inline-block" onclick="javascript:getStatus(101)">rent</button>


    <h1>DApp</h1>
    <h2 id="balance">Current Balance = <span id="currentBalance"></span></h2>
    <button id="button" style="display: block" onclick="javascript:getBalance()">Get New Balance</button>
    <hr />
    <br />
    <label for="newBalance" class="col-lg-2 control-label"><strong>New Balance</strong></label>
    <input id="newBalance" type="number" value="" style="display: inline-block">
    <button id="button" style="display: inline-block" onclick="javascript:setBalance()">Set New Balance</button>
    <br />
    <label><strong>Status</strong></label>
    <h4 id="status"></h4>
  </div>
</body>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
<script src="Lottoreum.json"></script>
<script>
  function addStatusLine(text) {
    document.getElementById("status").innerHTML = text + "<br/><br/>" + document.getElementById("status").innerHTML;
  }
  function getBalance() {
    addStatusLine("");
    addStatusLine("calling getBalance()");
    // TODO: Call getBalance Smart Contract
    SimpleContract.getBalance(function (errorGet, resultGet) {
      addStatusLine("Current balance =" + resultGet);
      document.getElementById('currentBalance').innerText = resultGet;
      document.getElementById('status101').innerText = resultGet;
    })
  }
  function setBalance() {
    // TODO: Call setBalance Smart Contract
    //addStatusLine("called");
    newBalance = parseInt(document.getElementById('newBalance').value);
    //addStatusLine(newBalance);
    SimpleContract.setBalance(newBalance, function (error, result) {
      if (error) {
        addStatusLine(error);
        return;
      }
      // addStatusLine("");
      addStatusLine("calling setBalance(" + newBalance + ")");
      txHash = result;
      addStatusLine("TxHash = <a href='https://kovan.etherscan.io/tx/" +
        result + "' target='_blank'>" + result + "</a>");
    });
  }



  function startApp() {
    var rentalContractAddress = "0x862782db3ef80b58ba641556047ab763581efa05";
    //dailyRentalContract = new web3js.eth.Contract(dailyRentalABI, rentalContractAddress);
    var rentalContractABI = web3.eth.contract(dailyRentalABI);
    dailyRentalContract = rentalContractABI.at(rentalContractAddress);
    userAccount = web3.eth.accounts[0];


  }

  function getStatusRoom101(room) {
    
    dailyRentalContract.getRoomStatus(room, function (errorGet, resultGet) {
      document.getElementById('status' + room).innerText = "haha"
    })
    
  }

  function getStatus(room) {
    document.getElementById('status' + room).innerText = "WTF";
    $("#txStatus").text("Creating new zombie on the blockchain. This may take a while...");
  }

  function createRandomZombie(name) {
    // ตรงนี้อาจจะต้องใช้เวลาซักเล็กน้อย ดังนั้นอย่าลืมที่จะอัพเดท UI ให้บอกผู้ใช้ด้วยว่า
    // transaction ได้ถูกส่งไปเป็นที่เรียบร้อยแล้ว
    $("#txStatus").text("Creating new zombie on the blockchain. This may take a while...");
    // ส่ง tx ไปยัง contract ของเรา:
    return CryptoZombies.methods.createRandomZombie(name)
      .send({ from: userAccount })
      .on("receipt", function (receipt) {
        $("#txStatus").text("Successfully created " + name + "!");
        // Block chain ยอมรับ transaction เข้ามาเป็นที่เรียบร้อย ได้เวลามาเขียน UI ใหม่กันแล้ว
        getZombiesByOwner(userAccount).then(displayZombies);
      })
      .on("error", function (error) {
        // เตือนผู้ใช้ว่ามีความล้มเหลวเกิดขึ้นในการส่ง transaction
        $("#txStatus").text(error);
      });
  }

  function getZombieDetails(id) {
    return cryptoZombies.methods.zombies(id).call()
  }

  window.addEventListener('load', function () {

    if (typeof web3 !== 'undefined') {
      // use MetaMask's provider
      web3js = new Web3(web3.currentProvider);
    } else {
      // if dont have metamask
    }
    startApp()

  });

  // Get default address
  web3.eth.defaultAccount = web3.eth.accounts[0];

  // TODO: Replace your SimpleContract contract address here
  var contractAddress = '0x3eb260d7847f83c164a67d4ccca6058c6594774c';
  // TODO: Replace your SimpleContract abi here
  var abi = [
    {
      "constant": false,
      "inputs": [
        {
          "name": "newBalance",
          "type": "uint256"
        }
      ],
      "name": "setBalance",
      "outputs": [],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [],
      "payable": false,
      "stateMutability": "nonpayable",
      "type": "constructor"
    },
    {
      "constant": true,
      "inputs": [],
      "name": "getBalance",
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "payable": false,
      "stateMutability": "view",
      "type": "function"
    }
  ];
    // Create an interface to SimpleContract on TomoChain
  var SimpleContractContract = web3.eth.contract(abi);
  var SimpleContract = SimpleContractContract.at(contractAddress);
  // Get Balance on the first load
  getBalance();
</script>
</html>